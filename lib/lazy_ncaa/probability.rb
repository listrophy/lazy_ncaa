module LazyNcaa
  class Probability
    PROBS = {
      1 => { #round 1
        1 => {16 => [112, 112]},
        2 => {15 => [112, 106]},
        3 => {14 => [112, 96]},
        4 => {13 => [112, 88]},
        5 => {12 => [112, 74]},
        6 => {11 => [112, 74]},
        7 => {10 => [112, 67]},
        8 => {9 =>  [112, 50]}
      },
      2 => { #round 2
        1 => {
          8 => [54,44],
          9 => [58,54]
        },
        2 => {
          7  => [65,47],
          10 => [41,24]
        },
        3 => {
          6  => [61,34],
          11 => [35,23]
        },
        4 => {
          5  => [60,32],
          12 => [28,17]
        },
        5 => {
          13 => [14,11]
        },
        6 => {
          14 => [13,11]
        },
        7 => {
          15 => [2,2]
        },
        10 => {
          15 => [4,4]
        },
        11 => {
          14 => [3,3]
        },
        12 => {
          13 => [10,8]
        }
      },
      3 => {
        1 => {
          4 => [41,30],
          5 => [36,30],
          12 => [18,18],
          13 => [3,3]
        },
        2 => {
          3 => [35,22],
          6 => [26,20],
          11 => [11,10]
        },
        3 => {
          7 => [9,6],
          10 => [13,9]
        },
        4 => {
          8 => [6,2],
          9 => [2,2]
        },
        5 => {
          8 => [2,0],
          9 => [2,1]
        },
        6 => {
          7 => [6,3],
          10 => [6,4]
        },
        7 => {
          11 => [3,0],
          14 => [1,1]
        },
        8 => {
          12 => [1,0],
          13 => [1,1]
        },
        10 => {
          11 => [1,1],
          14 => [1,1]
        }
      },
      4 => { #round 4
        1 => {
          2 => [38,18],
          3 => [20,12],
          6 => [8,6],
          7 => [4,4],
          10 => [4,4],
          11 => [5,2]
        },
        2 => {
          4 => [6,2],
          5 => [3,0],
          8 => [4,2],
          12 => [1,1]
        },
        3 => {
          4 => [3,2],
          5 => [3,2],
          8 => [1,1],
          9 => [1,1]
        },
        4 => {
          6 => [3,2],
          7 => [2,2],
          10 => [2,2]
        },
        5 => {
          6 => [1, 1],
          10 => [1,1]
        },
        6 => {
          8 => [1,0]
        },
        7 => {
          8 => [1,0]
        }
      },
      5 => { #all of final four
        1 => {
          2 => [17,12],
          3 => [7,3],
          4 => [8,6],
          5 => [4,4],
          6 => [2,1],
          8 => [2,1]
        },
        2 => {
          3 => [10,6],
          4 => [1,1],
          5 => [1,0],
          6 => [2,1],
          8 => [1,0],
          11 => [1,1]
        },
        3 => {
          4 => [2,2],
          8 => [1,1],
          11 => [1,1]
        },
        4 => {
          5 => [1,1],
          6 => [1,0]
        },
        5 => {
          8 => [1,1]
        },
        8 => {
          11 => [1,1]
        }
      }
    }

    # return probability that seed_a will win
    def self.ask(round, seed_a, seed_b)
      if seed_a == seed_b
        0.5
      else
        round = 5 if round == 6
        if seed_a < seed_b
          gw = PROBS[round][seed_a][seed_b]
          raise InvalidGameException if gw.nil?
          games = gw[0]
          wins = gw[1]
          1.0 * wins / games
        else
          gl = PROBS[round][seed_b][seed_a]
          raise InvalidGameException if gl.nil?
          games = gl[0]
          losses = gl[1]
          1.0 * (games - losses) / games
        end
      end
    end
  end
end
